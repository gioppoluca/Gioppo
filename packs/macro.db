{"name":"SubtleCricket","type":"script","scope":"global","author":"f2IZW0g7Izm7U70S","img":"icons/svg/dice-target.svg","command":"console.log(\"CALLED MACRO-----------------------\");\nconsole.log(args);\nif (args[0].macroPass == \"preDamageRoll\"){\n\tconsole.log(\"in predamage\");\n\tconst item = args[0].item; \n\tconsole.log(item);\nconst options = Array.fromRange(item.system.uses.value).reduce((acc, e) => { return acc + `<option value=\"${e+1}\">${e+1} charges</option>`; }, \"\"); \nconst content = ` <form> <div class=\"form-group\"> <label>Charges:</label> <div class=\"form-fields\"> <select><option value=\"0\">0 charges</option>${options}</select> </div></div></form>`; \nconst num = await Dialog.prompt({ title: \"Consume Charges\", content, rejectClose: false, callback: (html) => html[0].querySelector(\"select\").value }); \nif(!num) return; \nconst value = Number(num);\nconsole.log(value);\nif(value > 0){\n\tconst theItem = await fromUuid(args[0].uuid); \n\ttheItem.system.damage.parts[0][0]=\"1d6 + 1 + @mod + \" + value + \"d12\";\n\ttheItem.system.uses.value = theItem.system.uses.value - value;\n//await theItem.update({ \"system.uses.value\": theItem.system.uses.value - value });\n}\n\treturn;\n}\nif (args[0].macroPass == \"postDamageRoll\"){\n\tconsole.log(\"in postdamage\");\n\tconst item = args[0].item; \n\tconsole.log(item);\n\tconst theItem = await fromUuid(args[0].uuid); \n\ttheItem.system.damage.parts[0][0]=\"1d6 + 1 + @mod\";\n\treturn;\n}\nif(args[0].hitTargetUuids.length<1){\n\tconsole.log(\"not hit anything\");\n\treturn; \n}","ownership":{"default":0,"f2IZW0g7Izm7U70S":3},"flags":{"core":{"sourceId":"Macro.4HJZSIPguw6z5lej"},"scene-packer":{"sourceId":"Macro.4HJZSIPguw6z5lej","hash":"ca17ad1d42b667ae88ebca3b8dbdeb4670d2b02c"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.288","createdTime":1666629924678,"modifiedTime":1667128534610,"lastModifiedBy":"f2IZW0g7Izm7U70S"},"folder":null,"sort":0,"_id":"Z94APUika43dy6yz"}
